clear;

dir_data = './SimulatedData';
Nii      = nifti(spm_select('FPList',dir_data,'^.*\.nii$'));

VoxelSize           = 1;
Verbose             = 2;
WorkersParfor       = Inf;

IterMax             = 20;
Tolerance           = 0;

ADMMStepSize        = 1;
RegScaleSuperResMRI = 3;
DecreasingReg       = true;
CoRegister          = false;
IterImage           = 3;

%% ------------------------------
EstimateRigid   = true;
OutputDirectory = './Output/EstimateRigid/True';

spm_mtv_preproc('InputImages',Nii,'Method','superres', ...
                'VoxelSize',VoxelSize,'Verbose',Verbose, ...
                'RegScaleSuperResMRI',RegScaleSuperResMRI, ...                
                'ADMMStepSize',ADMMStepSize,'WorkersParfor',WorkersParfor, ...
                'Tolerance',Tolerance,'IterMax',IterMax, ...
                'DecreasingReg',DecreasingReg,'CoRegister',CoRegister, ...
                'EstimateRigid',EstimateRigid,'IterImage',IterImage, ...
                'OutputDirectory',OutputDirectory);
            
%% ------------------------------
EstimateRigid   = false;
OutputDirectory = './Output/EstimateRigid/False';

spm_mtv_preproc('InputImages',Nii,'Method','superres', ...
                'VoxelSize',VoxelSize,'Verbose',Verbose, ...
                'RegScaleSuperResMRI',RegScaleSuperResMRI, ...                
                'ADMMStepSize',ADMMStepSize,'WorkersParfor',WorkersParfor, ...
                'Tolerance',Tolerance,'IterMax',IterMax, ...
                'DecreasingReg',DecreasingReg,'CoRegister',CoRegister, ...
                'EstimateRigid',EstimateRigid,'IterImage',IterImage, ...
                'OutputDirectory',OutputDirectory);            